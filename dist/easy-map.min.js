"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var s=arguments[o];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,o){for(var s=0;s<o.length;s++){var r=o[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(o,s,r){return s&&e(o.prototype,s),r&&e(o,r),o}}(),UnsupportedBrowser=!!window.navigator.userAgent.match(/(msie [4-8]|opera mini)/i),EasyMap=function(){function e(o){_classCallCheck(this,e),this.version="1.0.3",this.availableMaps=["google","naver"],this.map={},this.mapType="",this.element=null,this.key="",this.source={lat:37.5666103,lng:126.9783882},this.sourceMarker={},this.sourceInfoWindow={},this.coords=[],this.coordsMarkers=[],this.coordsInfoWindows=[],this.markerNames=[],this.markerIds=[],this.closeInfoWindowAuto=!0,this.clickedNestedMarker=function(){},this.option=null,this.isValid(o)&&this.setProperties(o)}return _createClass(e,[{key:"isValid",value:function(e){var o="";if(UnsupportedBrowser&&(o="This Browser doesn't support Maps."),!e.mapType&&(o="mapType is required."),"string"!=typeof e.mapType&&(o="mapType must be string."),this.availableMaps.indexOf(e.mapType.toLowerCase())===-1&&(o="mapType must be included in "+this.availableMaps.join(", ")+"."),!e.element&&(o="element is required."),!e.element.nodeType&&(o="element must be DOM Element."),!e.key&&(o="key is required."),"string"!=typeof e.key&&(o="key must be string."),e.source&&"object"!==_typeof(e.source)&&(o="source must be object includes .lat, .lng."),e.coords&&!Array.isArray(e.coords)&&(o="coords must be array."),e.closeInfoWindowAudo&&"boolean"!=typeof e.closeInfoWindowAuto&&(o="closeInfoWindowAuto must be boolean."),e.clickedNestedMarker&&"function"!=typeof e.clickedNestedMarker&&(o="clickedNestedMarker must be function."),e.option&&"object"!==_typeof(e.option)&&(o="option must be object."),o)throw new Error(o);return!0}},{key:"setProperties",value:function(e){this.mapType=e.mapType,this.element=e.element,this.key=e.key,this.source=e.source||this.source,this.coords=e.coords||this.coords,this.closeInfoWindowAuto=e.closeInfoWindowAuto||this.closeInfoWindowAuto,this.clickedNestedMarker=e.clickedNestedMarker||this.clickedNestedMarker,e.option&&(this.option=e.option)}},{key:"getDistance",value:function(e,o){var s=6371e3,r=void 0,n=void 0,i=void 0,t=void 0,a=void 0;return r=this.deg2rad(o.lat-e.lat),n=this.deg2rad(o.lng-e.lng),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.deg2rad(o.lat))*Math.cos(this.deg2rad(e.lat))*Math.sin(n/2)*Math.sin(n/2),t=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),a=s*t,Math.round(a)}},{key:"deg2rad",value:function(e){return e*(Math.PI/180)}},{key:"initGoogleOption",value:function(e){return new google.maps.Map(this.element,e)}},{key:"initNaverOption",value:function(e){return new naver.maps.Map(this.element,e)}},{key:"markCurrentPosition",value:function(){var e=this.source.marker,o=this.source.infoWindow;if(e&&e.icon){var s={},r=+e.width,n=+e.height,i=e.verticalAlign,t=e.horizontalAlign,a=!(!r||!n);switch("top"===i?s.y=0:"bottom"===i?s.y=n:s.y=n/2,"left"===t?s.x=0:"right"===t?s.x=r:s.x=r/2,this.mapType){case"google":a?this.sourceMarker=new google.maps.Marker({position:this.source,map:this.map,icon:new google.maps.MarkerImage(this.source.marker.icon,new google.maps.Size(r,n),new google.maps.Point(0,0),new google.maps.Point(s.x,s.y),new google.maps.Size(r,n))}):this.sourceMarker=new google.maps.Marker({position:this.source,map:this.map,icon:new google.maps.MarkerImage(this.source.marker.icon)});break;case"naver":a?this.sourceMarker=new naver.maps.Marker({position:this.source,map:this.map,icon:{url:this.source.marker.icon,size:new naver.maps.Size(r,n),scaledSize:new naver.maps.Size(r,n),origin:new naver.maps.Point(0,0),anchor:new naver.maps.Point(s.x,s.y)}}):this.sourceMarker=new naver.maps.Marker({position:this.source,map:this.map,icon:{url:this.source.marker.icon}})}}else if(this.sourceMarker)switch(this.mapType){case"google":this.sourceMarker=new google.maps.Marker({position:this.source,map:this.map});break;case"naver":this.sourceMarker=new naver.maps.Marker({position:this.source,map:this.map})}if(o){var c=o&&o.content||"";switch(this.mapType){case"google":this.sourceInfoWindow=new google.maps.InfoWindow(_extends({},o,{content:c}));break;case"naver":this.sourceInfoWindow=new naver.maps.InfoWindow(_extends({},o,{content:c}))}}}},{key:"selectOne",value:function(e,o){if(o=+o||0,e.markerIds.indexOf(o)>-1){if(e.map.setCenter(e.coordsMarkers[o].getPosition()),e.closeInfoWindowAuto){e.sourceInfoWindow.close();for(var s=0,r=e.coords.length;s<r;s++)e.coordsInfoWindows[s].close()}e.coordsInfoWindows[e.coordsMarkers[o].__id].open(e.map,e.coordsMarkers[o])}}},{key:"createMarkers",value:function(){for(var e=void 0,o=void 0,s=void 0,r=void 0,n=void 0,i=0,t=this.coords.length;i<t;i++){var a=this.coords[i],c=a.infoWindow,p=a.marker;if(p&&p.icon){var d={};switch(e=+p.width,o=+p.height,s=p.verticalAlign,r=p.horizontalAlign,n=!(!e||!o),"top"===s?d.y=0:"bottom"===s?d.y=o:d.y=o/2,"left"===r?d.x=0:"right"===r?d.x=e:d.x=e/2,this.mapType){case"google":n?this.coordsMarkers[i]=new google.maps.Marker({position:a,map:this.map,icon:new google.maps.MarkerImage(a.marker.icon,new google.maps.Size(e,o),new google.maps.Point(0,0),new google.maps.Point(d.x,d.y),new google.maps.Size(e,o))}):this.coordsMarkers[i]=new google.maps.Marker({position:a,map:this.map,icon:new google.maps.MarkerImage(a.marker.icon)});break;case"naver":n?this.coordsMarkers[i]=new naver.maps.Marker({position:a,map:this.map,icon:{url:a.marker.icon,size:new naver.maps.Size(e,o),scaledSize:new naver.maps.Size(e,o),origin:new naver.maps.Point(0,0),anchor:new naver.maps.Point(d.x,d.y)}}):this.coordsMarkers[i]=new naver.maps.Marker({position:a,map:this.map,icon:{url:a.marker.icon}})}}else if(p)switch(this.mapType){case"google":this.coordsMarkers[i]=new google.maps.Marker({position:a,map:this.map});break;case"naver":this.coordsMarkers[i]=new naver.maps.Marker({position:a,map:this.map})}if(this.coordsMarkers[i].__id=i,this.coordsMarkers[i].__name=a.name||i,this.coordsMarkers[i].__distance=this.getDistance(this.source,a),c){var l=c&&c.content||"";switch(l=l.replace(/\{{2}distance\s?km\}{2}/gi,this.coordsMarkers[i].__distance/1e3+"km").replace(/\{{2}distance\s?m\}{2}/gi,this.coordsMarkers[i].__distance+"m").replace(/\{{2}distance\s?ft\}{2}/gi,this.coordsMarkers[i].__distance/.3048+" ft").replace(/\{{2}distance\s?yd\}{2}/gi,this.coordsMarkers[i].__distance/.9144+"yd"),this.mapType){case"google":this.coordsInfoWindows[i]=new google.maps.InfoWindow(_extends({},c,{content:l}));break;case"naver":this.coordsInfoWindows[i]=new naver.maps.InfoWindow(_extends({},c,{content:l}))}}}}},{key:"renderMap",value:function(){this.markCurrentPosition(),this.createMarkers(),this.subscribeInfoWindow()}},{key:"start",value:function(){var e=this,o=document.createElement("script");switch(o.type="text/javascript",this.mapType){case"google":var s=+new Date;o.src="//maps.googleapis.com/maps/api/js?key="+this.key+"&callback=easyMap"+s+"&libraries=geometry",window["easyMap"+s]=function(){e.map=e.initGoogleOption(e.option||{center:e.source,zoom:14,mapTypeId:window.google.maps.MapTypeId.ROADMAP,panControl:!0,zoomControl:!0,scaleControl:!0}),e.renderMap()};break;case"naver":o.src="//openapi.map.naver.com/openapi/v3/maps.js?clientId="+this.key,o.onload=function(){e.map=e.initNaverOption(e.option||{center:e.source,zoom:10}),e.renderMap()}}document.body.appendChild(o)}},{key:"subscribeInfoWindow",value:function(){var e=this;switch(this.mapType){case"google":google.maps.event.addListener(this.sourceMarker,"click",function(){if(e.map.setCenter(this.getPosition()),e.closeInfoWindowAuto)for(var o=0,s=e.coordsInfoWindows.length;o<s;o++)e.coordsInfoWindows[o].close();e.sourceInfoWindow.open(e.map,this)});for(var o=function(o,s){google.maps.event.addListener(e.coordsMarkers[o],"click",function(){for(var s=[],r=0,n=e.coordsMarkers.length;r<n;r++)this.getPosition().lat()===e.coordsMarkers[r].position.lat()&&this.getPosition().lng()===e.coordsMarkers[r].position.lng()&&s.push(e.coordsMarkers[r]);if(1===s.length||"function"!=typeof e.clickedNestedMarker){if(e.map.setCenter(this.getPosition()),e.closeInfoWindowAuto){e.sourceInfoWindow.close();for(var i=0,t=e.coordsInfoWindows.length;i<t;i++)e.coordsInfoWindows[i].close()}e.coordsInfoWindows[e.coordsMarkers[o].__id].open(e.map,this)}else{e.markerNames.length=0,e.markerIds.length=0;for(var a=0,c=s.length;a<c;a++)e.markerNames.push(s[a].__id+". "+s[a].__name),e.markerIds.push(s[a].__id);e.clickedNestedMarker(function(o){e.selectOne(e,o)},e.markerIds,e.markerNames.join("\n"))}})},s=0,r=this.coords.length;s<r;s++)o(s,r);break;case"naver":naver.maps.Event.addListener(this.sourceMarker,"click",function(){if(e.map.setCenter(e.sourceMarker.position),e.sourceInfoWindow.getMap()?e.sourceInfoWindow.close():e.sourceInfoWindow.open(e.map,e.sourceMarker),e.closeInfoWindowAuto)for(var o=0,s=e.coordsInfoWindows.length;o<s;o++)e.coordsInfoWindows[o].close()});for(var n=function(o,s){naver.maps.Event.addListener(e.coordsMarkers[o],"click",function(){for(var s=[],r=0,n=e.coordsMarkers.length;r<n;r++)e.coordsMarkers[o].position._lat===e.coordsMarkers[r].position._lat&&e.coordsMarkers[o].position._lng===e.coordsMarkers[r].position._lng&&s.push(e.coordsMarkers[r]);if(1===s.length||"function"!=typeof e.clickedNestedMarker){if(e.closeInfoWindowAuto){e.sourceInfoWindow.close();for(var i=0,t=e.coordsInfoWindows.length;i<t;i++)e.coordsInfoWindows[i].close()}e.coordsInfoWindows[o].getMap()?e.coordsInfoWindows[o].close():e.coordsInfoWindows[o].open(e.map,e.coordsMarkers[o]),e.map.setCenter(e.coordsInfoWindows[o].position)}else{e.markerNames.length=0,e.markerIds.length=0;for(var a=0,c=s.length;a<c;a++)e.markerNames.push(s[a].__id+". "+s[a].__name),e.markerIds.push(s[a].__id);e.clickedNestedMarker(function(o){e.selectOne(e,o)},e.markerIds,e.markerNames.join("\n"))}})},s=0,r=this.coords.length;s<r;s++)n(s,r)}}}]),e}();!function(e,o){return e=e||window,"function"==typeof e.define&&e.define.amd?define([],o):"object"===_typeof(e.module)&&e.module.exports?module.exports=o():e.EasyMap=o()}(void 0,function(){return EasyMap});