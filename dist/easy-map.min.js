"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,o){for(var s=0;s<o.length;s++){var t=o[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(o,s,t){return s&&e(o.prototype,s),t&&e(o,t),o}}(),UnsupportedBrowser=!!window.navigator.userAgent.match(/(msie [4-8]|opera mini)/i),EasyMap=function(){function e(o){_classCallCheck(this,e),this.version="1.0.0",this.availableMaps=["google"],this.map={},this.mapType="",this.element=null,this.key="",this.source={lat:37.5666103,lng:126.9783882},this.sourceMarker={},this.sourceInfoWindow={},this.coords=[],this.coordsMarkers=[],this.coordsInfoWindows=[],this.markerNames=[],this.markerIds=[],this.closeInfoWindowAuto=!0,this.clickedNestedMarker=function(){},this.option=null,this.isValid(o)&&this.setProperties(o)}return _createClass(e,[{key:"isValid",value:function(e){var o="";if(UnsupportedBrowser&&(o="This Browser doesn't support Maps."),!e.mapType&&(o="mapType is required."),"string"!=typeof e.mapType&&(o="mapType must be string."),this.availableMaps.indexOf(e.mapType.toLowerCase())===-1&&(o="mapType must be included in "+this.availableMaps.join(", ")+"."),!e.element&&(o="element is required."),!e.element.nodeType&&(o="element must be DOM Element."),!e.key&&(o="key is required."),"string"!=typeof e.key&&(o="key must be string."),e.source&&"object"!==_typeof(e.source)&&(o="source must be object includes .lat, .lng."),e.coords&&!Array.isArray(e.coords)&&(o="coords must be array."),e.closeInfoWindowAudo&&"boolean"!=typeof e.closeInfoWindowAuto&&(o="closeInfoWindowAuto must be boolean."),e.clickedNestedMarker&&"function"!=typeof e.clickedNestedMarker&&(o="clickedNestedMarker must be function."),e.option&&"object"!==_typeof(e.option)&&(o="option must be object."),o)throw new Error(o);return!0}},{key:"setProperties",value:function(e){this.mapType=e.mapType,this.element=e.element,this.key=e.key,this.source=e.source||this.source,this.coords=e.coords||this.coords,this.closeInfoWindowAuto=e.closeInfoWindowAuto||this.closeInfoWindowAuto,this.clickedNestedMarker=e.clickedNestedMarker||this.clickedNestedMarker,e.option&&(this.option=e.option)}},{key:"getDistance",value:function(e,o){var s=6371e3,t=void 0,i=void 0,r=void 0,n=void 0,a=void 0;return t=this.deg2rad(o.lat-e.lat),i=this.deg2rad(o.lng-e.lng),r=Math.sin(t/2)*Math.sin(t/2)+Math.cos(this.deg2rad(o.lat))*Math.cos(this.deg2rad(e.lat))*Math.sin(i/2)*Math.sin(i/2),n=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),a=s*n,Math.round(a)}},{key:"deg2rad",value:function(e){return e*(Math.PI/180)}},{key:"initGoogleOption",value:function(e){return new google.maps.Map(this.element,e)}},{key:"markCurrentPosition",value:function(){var e=this.source.marker,o=this.source.infoWindow;if(e&&e.icon){var s={},t=+e.width,i=+e.height,r=e.verticalAlign,n=e.horizontalAlign,a=!(!t||!i);switch("top"===r?s.y=0:"bottom"===r?s.y=i:s.y=i/2,"left"===n?s.x=0:"right"===n?s.x=t:s.x=t/2,this.mapType){case"google":a?this.sourceMarker=new google.maps.Marker({position:this.source,map:this.map,icon:new google.maps.MarkerImage(this.source.marker.icon,new google.maps.Size(t,i),new google.maps.Point(0,0),new google.maps.Point(s.x,s.y),new google.maps.Size(t,i))}):this.sourceMarker=new google.maps.Marker({position:this.source,map:this.map,icon:new google.maps.MarkerImage(this.source.marker.icon)})}}else switch(this.mapType){case"google":this.sourceMarker=new google.maps.Marker({position:this.source,map:this.map})}if(o)switch(this.mapType){case"google":var c=o&&o.content||"";this.sourceInfoWindow=new google.maps.InfoWindow({content:c,maxWidth:o.maxWidth})}}},{key:"selectOne",value:function(e,o){if(o=+o||0,e.markerIds.indexOf(o)>-1){if(e.map.setCenter(e.coordsMarkers[o].getPosition()),e.closeInfoWindowAuto){e.sourceInfoWindow.close();for(var s=0,t=e.coords.length;s<t;s++)e.coordsInfoWindows[s].close()}e.coordsInfoWindows[e.coordsMarkers[o].__id].open(e.map,e.coordsMarkers[o])}}},{key:"createMarkers",value:function(){for(var e=void 0,o=void 0,s=void 0,t=void 0,i=void 0,r=0,n=this.coords.length;r<n;r++){var a=this.coords[r],c=a.infoWindow,d=a.marker;if(d&&d.icon){var l={};switch(e=+d.width,o=+d.height,s=d.verticalAlign,t=d.horizontalAlign,i=!(!e||!o),"top"===s?l.y=0:"bottom"===s?l.y=o:l.y=o/2,"left"===t?l.x=0:"right"===t?l.x=e:l.x=e/2,this.mapType){case"google":i?this.coordsMarkers[r]=new google.maps.Marker({position:a,map:this.map,icon:new google.maps.MarkerImage(a.marker.icon,new google.maps.Size(e,o),new google.maps.Point(0,0),new google.maps.Point(l.x,l.y),new google.maps.Size(e,o))}):this.sourceMarker=new google.maps.Marker({position:a,map:this.map,icon:new google.maps.MarkerImage(a.marker.icon)})}}else this.coordsMarkers[r]=new google.maps.Marker({position:a,map:this.map});if(this.coordsMarkers[r].__id=r,this.coordsMarkers[r].__name=a.name||r,this.coordsMarkers[r].__distance=this.getDistance(this.source,a),c){var p=c&&c.content||"";switch(p=p.replace(/\{{2}distance\s?km\}{2}/gi,this.coordsMarkers[r].__distance/1e3+"km").replace(/\{{2}distance\s?m\}{2}/gi,this.coordsMarkers[r].__distance+"m").replace(/\{{2}distance\s?ft\}{2}/gi,this.coordsMarkers[r].__distance/.3048+" ft").replace(/\{{2}distance\s?yd\}{2}/gi,this.coordsMarkers[r].__distance/.9144+"yd"),this.mapType){case"google":this.coordsInfoWindows[r]=new google.maps.InfoWindow({content:p,maxWidth:c.maxWidth})}}}}},{key:"renderMap",value:function(){this.markCurrentPosition(),this.createMarkers(),this.subscribeInfoWindow()}},{key:"start",value:function(){var e=this,o=document.createElement("script");switch(o.type="text/javascript",this.mapType){case"google":var s=+new Date;o.src="//maps.googleapis.com/maps/api/js?key="+this.key+"&callback=easyMap"+s+"&libraries=geometry",window["easyMap"+s]=function(){e.map=e.initGoogleOption(e.option||{center:e.source,zoom:14,mapTypeId:window.google.maps.MapTypeId.ROADMAP,panControl:!0,zoomControl:!0,scaleControl:!0}),e.renderMap()},document.body.appendChild(o)}}},{key:"subscribeInfoWindow",value:function(){var e=this;google.maps.event.addListener(this.sourceMarker,"click",function(){if(e.map.setCenter(this.getPosition()),e.closeInfoWindowAuto)for(var o=0,s=e.coordsInfoWindows.length;o<s;o++)e.coordsInfoWindows[o].close();e.sourceInfoWindow.open(e.map,this)});for(var o=function(o,s){google.maps.event.addListener(e.coordsMarkers[o],"click",function(){for(var s=[],t=0,i=e.coordsMarkers.length;t<i;t++)this.getPosition().lat()===e.coordsMarkers[t].position.lat()&&this.getPosition().lng()===e.coordsMarkers[t].position.lng()&&s.push(e.coordsMarkers[t]);if(1===s.length||"function"!=typeof e.clickedNestedMarker){if(e.map.setCenter(this.getPosition()),e.closeInfoWindowAuto){e.sourceInfoWindow.close();for(var r=0,n=e.coordsInfoWindows.length;r<n;r++)e.coordsInfoWindows[r].close()}e.coordsInfoWindows[e.coordsMarkers[o].__id].open(e.map,this)}else{e.markerNames.length=0,e.markerIds.length=0;for(var a=0,c=s.length;a<c;a++)e.markerNames.push(s[a].__id+". "+s[a].__name),e.markerIds.push(s[a].__id);e.clickedNestedMarker(function(o){e.selectOne(e,o)},e.markerIds,e.markerNames.join("\n"))}})},s=0,t=this.coords.length;s<t;s++)o(s,t)}}]),e}();!function(e,o){return e=e||window,"function"==typeof e.define&&e.define.amd?define([],o):"object"===_typeof(e.module)&&e.module.exports?module.exports=o():e.EasyMap=o()}(void 0,function(){return EasyMap});